local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")

-- GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 220, 0, 100)
Frame.Position = UDim2.new(0, 50, 0, 50)
Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Frame.BorderSizePixel = 0
Frame.Parent = ScreenGui

-- Botão fechar "X"
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 25, 0, 25)
CloseButton.Position = UDim2.new(1, -30, 0, 5)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Text = "X"
CloseButton.Parent = Frame

local ToggleButton = Instance.new("TextButton")
ToggleButton.Size = UDim2.new(1, -10, 0, 50)
ToggleButton.Position = UDim2.new(0, 5, 0, 35)
ToggleButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.Text = "Start Auto-Star"
ToggleButton.Parent = Frame

local AutoCollect = false
local ScriptRunning = true

-- Fechar GUI
CloseButton.MouseButton1Click:Connect(function()
    ScriptRunning = false
    ScreenGui:Destroy()
end)

-- Função para encontrar todas as estrelas
local function findStars(parent)
    local stars = {}
    for _, obj in pairs(parent:GetChildren()) do
        if obj:IsA("BasePart") and obj.Name:lower():find("star") then
            table.insert(stars, obj)
        elseif obj:IsA("Model") and obj.PrimaryPart and obj.Name:lower():find("star") then
            table.insert(stars, obj.PrimaryPart)
        end
        local inner = findStars(obj)
        for _, v in pairs(inner) do
            table.insert(stars, v)
        end
    end
    return stars
end

-- Função para andar até a estrela com velocidade normal
local function walkToStar(star)
    local character = LocalPlayer.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") or not character:FindFirstChild("Humanoid") then return end
    local hrp = character.HumanoidRootPart
    local humanoid = character.Humanoid

    while (hrp.Position - star.Position).Magnitude > 3 and ScriptRunning do
        local direction = (star.Position - hrp.Position).Unit
        -- Simular pequenas variações na direção para parecer humano
        local randomOffset = Vector3.new(math.random(-2,2)/10,0,math.random(-2,2)/10)
        local moveVector = (direction + randomOffset).Unit * humanoid.WalkSpeed * 0.05
        hrp.CFrame = hrp.CFrame + moveVector
        wait(0.05)
    end
end

-- Loop principal
spawn(function()
    while ScriptRunning do
        if AutoCollect then
            local stars = findStars(workspace)
            if #stars > 0 then
                -- Escolhe a estrela mais próxima
                table.sort(stars, function(a,b)
                    return (a.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude < 
                           (b.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
                end)
                local nearestStar = stars[1]
                walkToStar(nearestStar)
                wait(math.random(5,12)/10) -- delay aleatório após coletar
            end
        end
        wait(0.5)
    end
end)

-- Botão ligar/desligar
ToggleButton.MouseButton1Click:Connect(function()
    AutoCollect = not AutoCollect
    ToggleButton.Text = AutoCollect and "Stop Auto-Star" or "Start Auto-Star"
end)
