-- Auto Collect Stars com GUI (botão ON/OFF)
-- Coleta estrelas usando firetouchinterest / ProximityPrompt / micro-teleport

getgenv().AutoCollect = false
getgenv().PreferStealth = true
getgenv().ScanRadius = 350
getgenv().LoopInterval = 0.25

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local StarterGui = game:GetService("StarterGui")

-- === INTERFACE ===
local ScreenGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local Button = Instance.new("TextButton")

ScreenGui.Parent = game.CoreGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

Frame.Parent = ScreenGui
Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Frame.Size = UDim2.new(0, 200, 0, 80)
Frame.Position = UDim2.new(0.05, 0, 0.2, 0)
Frame.Active = true
Frame.Draggable = true
Frame.BorderSizePixel = 0
Frame.BackgroundTransparency = 0.1
Frame.Visible = true

Button.Parent = Frame
Button.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
Button.TextColor3 = Color3.fromRGB(255, 255, 255)
Button.TextScaled = true
Button.Text = "Auto Collect: OFF"
Button.Size = UDim2.new(1, -20, 1, -20)
Button.Position = UDim2.new(0, 10, 0, 10)
Button.Font = Enum.Font.SourceSansBold
Button.BorderSizePixel = 0
Button.AutoButtonColor = true

-- Função de notificação
local function notify(txt)
    pcall(function()
        StarterGui:SetCore("SendNotification", {Title="Auto Star", Text=txt, Duration=2})
    end)
    print("[AutoStar] "..txt)
end

-- Toggle no botão
Button.MouseButton1Click:Connect(function()
    getgenv().AutoCollect = not getgenv().AutoCollect
    Button.Text = getgenv().AutoCollect and "Auto Collect: ON" or "Auto Collect: OFF"
    Button.BackgroundColor3 = getgenv().AutoCollect and Color3.fromRGB(0, 170, 0) or Color3.fromRGB(45, 45, 45)
    notify(getgenv().AutoCollect and "ON" or "OFF")
end)

-- === FUNÇÕES DE COLETA ===
local function hrp()
    local c = player.Character or player.CharacterAdded:Wait()
    return c:WaitForChild("HumanoidRootPart")
end

local function tryTouch(h, part)
    local ok = false
    pcall(function()
        firetouchinterest(h, part, 0); task.wait()
        firetouchinterest(h, part, 1)
        ok = true
    end)
    pcall(function()
        firetouchinterest(part, h, 0); task.wait()
        firetouchinterest(part, h, 1)
        ok = true
    end)
    return ok
end

local function tryProximityPrompt(model)
    local fired = false
    for _, d in ipairs(model:GetDescendants()) do
        if d:IsA("ProximityPrompt") then
            pcall(function()
                fireproximityprompt(d)
                fired = true
            end)
        end
    end
    return fired
end

local function microTP(h, part)
    local cf = h.CFrame
    h.CFrame = part.CFrame + Vector3.new(0, 3, 0)
    task.wait(0.10)
    h.CFrame = cf
end

local function findStarTouchParts()
    local list = {}
    if workspace:FindFirstChild("Stars") then
        for _, m in ipairs(workspace.Stars:GetChildren()) do
            if m:IsA("Model") then
                local tp = m:FindFirstChild("TouchPart")
                    or m:FindFirstChildWhichIsA("BasePart")
                if tp then table.insert(list, tp) end
            end
        end
    end
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("BasePart") then
            local p = obj.Parent
            if (obj.Name == "TouchPart" or obj.Name == "Star")
               and p and p:IsA("Model")
               and p.Name:lower():find("star") then
                table.insert(list, obj.Name == "TouchPart" and obj or (p:FindFirstChild("TouchPart") or obj))
            end
        end
    end
    return list
end

local function collectOne(h, part)
    if not (part and part:IsDescendantOf(workspace)) then return end
    local m = part:FindFirstAncestorOfClass("Model")
    if m and tryProximityPrompt(m) then return end
    local worked = false
    if getgenv().PreferStealth then
        worked = tryTouch(h, part)
    end
    if not worked then
        microTP(h, part)
    end
end

-- === LOOP PRINCIPAL ===
task.spawn(function()
    while true do
        if getgenv().AutoCollect then
            local h = hrp()
            local pos = h.Position
            for _, part in ipairs(findStarTouchParts()) do
                if (part.Position - pos).Magnitude <= getgenv().ScanRadius then
                    collectOne(h, part)
                    task.wait(0.05)
                end
            end
        end
        task.wait(getgenv().LoopInterval)
    end
end)

notify("Auto Collect GUI carregada!")
